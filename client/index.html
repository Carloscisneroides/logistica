<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#1e40af" />
    <meta name="background-color" content="#0f172a" />
    
    <!-- Mobile App Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="NYVRA" />
    <meta name="msapplication-TileColor" content="#1e40af" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- App Icons for iOS -->
    <link rel="apple-touch-icon" sizes="180x180" href="/pwa-assets/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/pwa-assets/icon-152.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/pwa-assets/icon-144.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/pwa-assets/icon-120.png" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/pwa-assets/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/pwa-assets/favicon-16x16.png" />
    
    <!-- Windows Tiles -->
    <meta name="msapplication-TileImage" content="/pwa-assets/icon-144.png" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
    
    <!-- SEO and App Description -->
    <title>NYVRA - Network Yield Verification Risk Analysis</title>
    <meta name="description" content="Enterprise-grade AI-powered antifraud and risk analysis platform. Real-time network analysis and predictive fraud detection for logistics, eCommerce and financial operations." />
    <meta name="keywords" content="antifraud, risk analysis, AI, machine learning, fraud detection, network intelligence, enterprise security" />
    <meta name="author" content="NYVRA Platform" />
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="NYVRA - Network Yield Verification Risk Analysis" />
    <meta property="og:description" content="AI-powered antifraud platform for enterprise risk management and predictive fraud detection" />
    <meta property="og:image" content="/pwa-assets/og-image.png" />
    <meta property="og:url" content="/" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="NYVRA Platform" />
    <meta name="twitter:description" content="Network Yield Verification Risk Analysis - AI Antifraud System" />
    <meta name="twitter:image" content="/pwa-assets/og-image.png" />
    
    <!-- Preload Critical Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Prevent zoom on inputs for iOS -->
    <style>
      @media screen and (-webkit-min-device-pixel-ratio: 0) {
        select, textarea, input[type="text"], input[type="password"], 
        input[type="datetime"], input[type="datetime-local"], 
        input[type="date"], input[type="month"], input[type="time"], 
        input[type="week"], input[type="number"], input[type="email"], 
        input[type="url"], input[type="search"], input[type="tel"], 
        input[type="color"] {
          font-size: 16px !important;
        }
      }
      
      /* Hide scrollbars in app mode */
      .pwa-mode {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .pwa-mode::-webkit-scrollbar {
        display: none;
      }
      
      /* Safe area insets for notched devices */
      .safe-area-top {
        padding-top: env(safe-area-inset-top);
      }
      .safe-area-bottom {
        padding-bottom: env(safe-area-inset-bottom);
      }
    </style>
  </head>
  <body class="pwa-mode">
    <div id="root" class="safe-area-top safe-area-bottom"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
      // Register Service Worker for PWA functionality
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('üöÄ NYVRA PWA: Service Worker registered successfully:', registration.scope);
              
              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                if (newWorker) {
                  newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                      // New version available
                      console.log('üîÑ NYVRA PWA: New version available');
                      
                      // Optionally show update notification
                      if (window.confirm('Nuova versione di NYVRA disponibile. Aggiornare ora?')) {
                        window.location.reload();
                      }
                    }
                  });
                }
              });
            })
            .catch((error) => {
              console.log('‚ùå NYVRA PWA: Service Worker registration failed:', error);
            });
        });
      }
      
      // PWA Install Prompt
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('üì± NYVRA PWA: Install prompt available');
        e.preventDefault();
        deferredPrompt = e;
        
        // Show custom install button/banner
        const installBanner = document.createElement('div');
        installBanner.id = 'install-banner';
        installBanner.innerHTML = `
          <div style="
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            background: linear-gradient(90deg, #1e40af, #3b82f6); 
            color: white; 
            padding: 12px 16px; 
            text-align: center; 
            z-index: 10000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transform: translateY(-100%);
            transition: transform 0.3s ease;
          ">
            <span style="font-weight: 600; margin-right: 12px;">üì± Installa NYVRA come App</span>
            <button id="install-btn" style="
              background: rgba(255,255,255,0.2); 
              border: 1px solid rgba(255,255,255,0.3); 
              color: white; 
              padding: 6px 12px; 
              border-radius: 6px; 
              margin-right: 8px;
              cursor: pointer;
              font-weight: 500;
            ">Installa</button>
            <button id="dismiss-btn" style="
              background: transparent; 
              border: none; 
              color: rgba(255,255,255,0.8); 
              cursor: pointer;
              font-size: 18px;
              padding: 6px;
            ">√ó</button>
          </div>
        `;
        document.body.appendChild(installBanner);
        
        // Animate in
        setTimeout(() => {
          installBanner.querySelector('div').style.transform = 'translateY(0)';
        }, 1000);
        
        // Install button click
        document.getElementById('install-btn').addEventListener('click', () => {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('‚úÖ NYVRA PWA: User accepted the install prompt');
            } else {
              console.log('‚ùå NYVRA PWA: User dismissed the install prompt');
            }
            deferredPrompt = null;
            document.body.removeChild(installBanner);
          });
        });
        
        // Dismiss button click
        document.getElementById('dismiss-btn').addEventListener('click', () => {
          document.body.removeChild(installBanner);
        });
      });
      
      // PWA Install Success
      window.addEventListener('appinstalled', (evt) => {
        console.log('üéâ NYVRA PWA: App was installed successfully');
        
        // Track install event
        if (typeof gtag === 'function') {
          gtag('event', 'pwa_install', {
            event_category: 'engagement',
            event_label: 'NYVRA PWA Installed'
          });
        }
      });
      
      // Detect PWA launch
      window.addEventListener('DOMContentLoaded', () => {
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
        const isIOSStandalone = 'standalone' in window.navigator && window.navigator.standalone;
        
        if (isStandalone || isIOSStandalone) {
          console.log('üì± NYVRA PWA: Running in app mode');
          document.body.classList.add('pwa-standalone');
          
          // Add app-specific behaviors
          document.documentElement.style.setProperty('--app-mode', '1');
        }
      });
      
      // Handle offline/online status
      function updateOnlineStatus() {
        const status = navigator.onLine ? 'online' : 'offline';
        console.log(`üåê NYVRA PWA: Network status changed to ${status}`);
        
        if (!navigator.onLine) {
          // Show offline indicator
          const offlineIndicator = document.createElement('div');
          offlineIndicator.id = 'offline-indicator';
          offlineIndicator.innerHTML = `
            <div style="
              position: fixed;
              bottom: 20px;
              left: 50%;
              transform: translateX(-50%);
              background: #ef4444;
              color: white;
              padding: 8px 16px;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              z-index: 10000;
              box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            ">
              üîå Modalit√† Offline - Alcune funzioni potrebbero essere limitate
            </div>
          `;
          document.body.appendChild(offlineIndicator);
        } else {
          // Remove offline indicator
          const indicator = document.getElementById('offline-indicator');
          if (indicator) {
            document.body.removeChild(indicator);
          }
        }
      }
      
      window.addEventListener('online', updateOnlineStatus);
      window.addEventListener('offline', updateOnlineStatus);
    </script>
  </body>
</html>